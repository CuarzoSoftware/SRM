<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SRM: ðŸŽ“ Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">SRM<span id="projectnumber">&#160;v0.13.0-1</span>
   </div>
   <div id="projectbrief">Simple Rendering Manager</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('tutorial_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ðŸŽ“ Tutorial</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial, you will learn the basics of SRM to kickstart your journey into creating DRM/KMS applications with OpenGL ES 2.0.</p>
<p>Let's begin by creating an empty project directory, with a <code>main.c</code> and <code>meson.build</code> file inside. In this example, we will use Meson as our build system.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
main.c</h2>
<div class="fragment"><div class="line">int main()</div>
<div class="line">{</div>
<div class="line">    return 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md17"></a>
meson.build</h2>
<div class="fragment"><div class="line">project(&#39;srm-example&#39;,</div>
<div class="line">        &#39;c&#39;,</div>
<div class="line">        version : &#39;0.1.0&#39;)</div>
<div class="line"> </div>
<div class="line">c = meson.get_compiler(&#39;c&#39;)</div>
<div class="line"> </div>
<div class="line">pkg = import(&#39;pkgconfig&#39;)</div>
<div class="line">glesv2_dep = dependency(&#39;glesv2&#39;)</div>
<div class="line">srm_dep = dependency(&#39;SRM&#39;)</div>
<div class="line">m_dep = c.find_library(&#39;m&#39;)</div>
<div class="line">   </div>
<div class="line">sources = [&#39;main.c&#39;]</div>
<div class="line"> </div>
<div class="line">executable(</div>
<div class="line">    &#39;srm-example&#39;,</div>
<div class="line">    sources,</div>
<div class="line">    dependencies: [glesv2_dep, srm_dep, m_dep])</div>
</div><!-- fragment --><p>Now, let's configure the project by running the following commands in your project directory:</p>
<div class="fragment"><div class="line">cd your_project_dir</div>
<div class="line">meson setup builddir</div>
</div><!-- fragment --><p>You should observe output confirming that the GLESv2, SRM and Math libraries have been found, and a new <code>builddir</code> directory should be created.</p>
<div class="fragment"><div class="line">...</div>
<div class="line"> </div>
<div class="line">Found pkg-config: /usr/bin/pkg-config (0.29.2)</div>
<div class="line">Run-time dependency glesv2 found: YES 3.2</div>
<div class="line">Run-time dependency srm found: YES 0.3.2</div>
<div class="line">Library m found: YES</div>
<div class="line">Build targets in project: 1</div>
</div><!-- fragment --><p>If this is not the case, and the libraries are not found, please double-check that you have installed the GLESv2 and SRM libraries correctly, or investigate if any environment configuration adjustments are necessary.</p>
<p>Please refer to the <a href="md_md__downloads.html">Downloads</a> section for detailed installation instructions for SRM.</p>
<p>Now, in <code>main.c</code> let's set up an interface that allows SRM to open and close DRM devices.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;SRM/SRMCore.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SRM/SRMDevice.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SRM/SRMConnector.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SRM/SRMConnectorMode.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SRM/SRMList.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SRM/SRMLog.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;GLES2/gl2.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">float</span> color = 0.f;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Opens a DRM device */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> openRestricted(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> flags, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(userData);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Here something like libseat could be used instead</span></div>
<div class="line">    <span class="keywordflow">return</span> open(path, flags);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Closes a DRM device */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> closeRestricted(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(userData);</div>
<div class="line">    close(fd);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_struct" href="struct_s_r_m_interface.html">SRMInterface</a> srmInterface =</div>
<div class="line">{</div>
<div class="line">    .<a class="code hl_variable" href="struct_s_r_m_interface.html#ad0c1935149c7a958d6d3578b864e6eb0">openRestricted</a> = &amp;openRestricted,</div>
<div class="line">    .closeRestricted = &amp;closeRestricted</div>
<div class="line">};</div>
<div class="ttc" id="agroup___s_r_m_types_html_ga1fa8cad2c59d1d2c01d30d75c68ecf81"><div class="ttname"><a href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a></div><div class="ttdeci">#define SRM_UNUSED(var)</div><div class="ttdoc">Macro to suppress &quot;unused parameter&quot; warnings.</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:42</div></div>
<div class="ttc" id="astruct_s_r_m_interface_html"><div class="ttname"><a href="struct_s_r_m_interface.html">SRMInterface</a></div><div class="ttdoc">Interface for managing DRM devices (/dev/dri/card*).</div><div class="ttdef"><b>Definition</b> SRMCore.h:38</div></div>
<div class="ttc" id="astruct_s_r_m_interface_html_ad0c1935149c7a958d6d3578b864e6eb0"><div class="ttname"><a href="struct_s_r_m_interface.html#ad0c1935149c7a958d6d3578b864e6eb0">SRMInterface::openRestricted</a></div><div class="ttdeci">int(* openRestricted)(const char *path, int flags, void *data)</div><div class="ttdef"><b>Definition</b> SRMCore.h:47</div></div>
</div><!-- fragment --><p>This interface handles the management of DRM file descriptors during SRMCore's device scanning process and when you call <a class="el" href="group___s_r_m_core.html#ga491d9d7ebe4c63ddd2768a11487d3134" title="Uninitializes all initialized connectors, removes all resources associated, closes all DRM devices,...">srmCoreDestroy()</a>.</p>
<p>Instead of relying solely on the <code>open()</code> and <code>close()</code> functions, you might consider incorporating a library like <a href="https://github.com/kennylevinsen/seatd">libseat</a> to enhance your program's compatibility with multi-session setups, enabling seamless TTY switching (like in the <a href="https://github.com/CuarzoSoftware/SRM/tree/main/src/examples/srm-multi-session">srm-multi-session</a> example).</p>
<p>Let's proceed by creating an <code>SRMCore</code> instance using this interface. If any errors arise during the <code>SRMCore</code> creation process, we will ensure a graceful program exit.</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group___s_r_m_core.html#ga535bab8ce74776687f1b66a321b35015">SRMCore</a> *core = <a class="code hl_function" href="group___s_r_m_core.html#gabc5505d6e241d3f651b141603739f91e">srmCoreCreate</a>(&amp;srmInterface, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!core)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#ga8a60293d45a096708565a6adabac25fe">SRMFatal</a>(<span class="stringliteral">&quot;[srm-example] Failed to create SRMCore.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_core.html#ga491d9d7ebe4c63ddd2768a11487d3134">srmCoreDestroy</a>(core);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup___s_r_m_core_html_ga491d9d7ebe4c63ddd2768a11487d3134"><div class="ttname"><a href="group___s_r_m_core.html#ga491d9d7ebe4c63ddd2768a11487d3134">srmCoreDestroy</a></div><div class="ttdeci">void srmCoreDestroy(SRMCore *core)</div><div class="ttdoc">Uninitializes all initialized connectors, removes all resources associated, closes all DRM devices,...</div></div>
<div class="ttc" id="agroup___s_r_m_core_html_ga535bab8ce74776687f1b66a321b35015"><div class="ttname"><a href="group___s_r_m_core.html#ga535bab8ce74776687f1b66a321b35015">SRMCore</a></div><div class="ttdeci">struct SRMCoreStruct SRMCore</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:108</div></div>
<div class="ttc" id="agroup___s_r_m_core_html_gabc5505d6e241d3f651b141603739f91e"><div class="ttname"><a href="group___s_r_m_core.html#gabc5505d6e241d3f651b141603739f91e">srmCoreCreate</a></div><div class="ttdeci">SRMCore * srmCoreCreate(SRMInterface *interface, void *userData)</div><div class="ttdoc">Creates a new SRMCore instance.</div></div>
<div class="ttc" id="agroup___s_r_m_log_html_ga8a60293d45a096708565a6adabac25fe"><div class="ttname"><a href="group___s_r_m_log.html#ga8a60293d45a096708565a6adabac25fe">SRMFatal</a></div><div class="ttdeci">void SRMFatal(const char *format,...)</div><div class="ttdoc">Report an unrecoverable error. SRM_DEBUG &gt;= 1.</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md18"></a>
Devices and Connectors</h3>
<p>Now lets enumerate all avaliable devices (GPUs) and their respective connectors (displays).</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group___s_r_m_core.html#ga535bab8ce74776687f1b66a321b35015">SRMCore</a> *core = <a class="code hl_function" href="group___s_r_m_core.html#gabc5505d6e241d3f651b141603739f91e">srmCoreCreate</a>(&amp;srmInterface, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!core)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#ga8a60293d45a096708565a6adabac25fe">SRMFatal</a>(<span class="stringliteral">&quot;[srm-example] Failed to create SRMCore.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Loop each GPU (device)</span></div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a> (deviceIt, <a class="code hl_function" href="group___s_r_m_core.html#gafb45ad48fb818c38a7a3064c67fed689">srmCoreGetDevices</a>(core))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_typedef" href="group___s_r_m_device.html#ga485029078e487fd57bbda129ca369db5">SRMDevice</a> *device = <a class="code hl_function" href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a>(deviceIt);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a>(<span class="stringliteral">&quot;[srm-example] Device %s connectors:&quot;</span>, <a class="code hl_function" href="group___s_r_m_device.html#ga4b8f4e240df729a8244220706bd046ae">srmDeviceGetName</a>(device));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Loop each GPU connector (screen)</span></div>
<div class="line">        <a class="code hl_define" href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a> (connectorIt, <a class="code hl_function" href="group___s_r_m_device.html#ga077ac04ca0f71c03c3ef0364b466c525">srmDeviceGetConnectors</a>(device))</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector = <a class="code hl_function" href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a>(connectorIt);</div>
<div class="line">            <a class="code hl_function" href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a>(<span class="stringliteral">&quot;[srm-example] - Connector %d %s %s %s.&quot;</span>,</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga2749a649be32fdff7627af6e4b00fbf8">srmConnectorGetID</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga5cabbb1dbf56c76797eb6dea2ebed898">srmConnectorGetModel</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga0be5072f8fddeb1a5b0431a17b3491c2">srmConnectorGetManufacturer</a>(connector));</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_core.html#ga491d9d7ebe4c63ddd2768a11487d3134">srmCoreDestroy</a>(core);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga0be5072f8fddeb1a5b0431a17b3491c2"><div class="ttname"><a href="group___s_r_m_connector.html#ga0be5072f8fddeb1a5b0431a17b3491c2">srmConnectorGetManufacturer</a></div><div class="ttdeci">const char * srmConnectorGetManufacturer(SRMConnector *connector)</div><div class="ttdoc">Get the manufacturer of the connected display.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga2294dccfe3dd0eaf3fc25ce33e50f397"><div class="ttname"><a href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a></div><div class="ttdeci">const char * srmConnectorGetName(SRMConnector *connector)</div><div class="ttdoc">Get the name of the connector.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga2749a649be32fdff7627af6e4b00fbf8"><div class="ttname"><a href="group___s_r_m_connector.html#ga2749a649be32fdff7627af6e4b00fbf8">srmConnectorGetID</a></div><div class="ttdeci">UInt32 srmConnectorGetID(SRMConnector *connector)</div><div class="ttdoc">Get the DRM connector ID.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga5cabbb1dbf56c76797eb6dea2ebed898"><div class="ttname"><a href="group___s_r_m_connector.html#ga5cabbb1dbf56c76797eb6dea2ebed898">srmConnectorGetModel</a></div><div class="ttdeci">const char * srmConnectorGetModel(SRMConnector *connector)</div><div class="ttdoc">Get the model of the connected display.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_gae730ec771a6d54b3bdee04d719bd799f"><div class="ttname"><a href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a></div><div class="ttdeci">struct SRMConnectorStruct SRMConnector</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:128</div></div>
<div class="ttc" id="agroup___s_r_m_core_html_gafb45ad48fb818c38a7a3064c67fed689"><div class="ttname"><a href="group___s_r_m_core.html#gafb45ad48fb818c38a7a3064c67fed689">srmCoreGetDevices</a></div><div class="ttdeci">SRMList * srmCoreGetDevices(SRMCore *core)</div><div class="ttdoc">Get a list of all available devices (SRMDevice).</div></div>
<div class="ttc" id="agroup___s_r_m_device_html_ga077ac04ca0f71c03c3ef0364b466c525"><div class="ttname"><a href="group___s_r_m_device.html#ga077ac04ca0f71c03c3ef0364b466c525">srmDeviceGetConnectors</a></div><div class="ttdeci">SRMList * srmDeviceGetConnectors(SRMDevice *device)</div><div class="ttdoc">Get a list of connectors of this device.</div></div>
<div class="ttc" id="agroup___s_r_m_device_html_ga485029078e487fd57bbda129ca369db5"><div class="ttname"><a href="group___s_r_m_device.html#ga485029078e487fd57bbda129ca369db5">SRMDevice</a></div><div class="ttdeci">struct SRMDeviceStruct SRMDevice</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:112</div></div>
<div class="ttc" id="agroup___s_r_m_device_html_ga4b8f4e240df729a8244220706bd046ae"><div class="ttname"><a href="group___s_r_m_device.html#ga4b8f4e240df729a8244220706bd046ae">srmDeviceGetName</a></div><div class="ttdeci">const char * srmDeviceGetName(SRMDevice *device)</div><div class="ttdoc">Get the DRM device name (e.g., /dev/dri/card0) associated with this device.</div></div>
<div class="ttc" id="agroup___s_r_m_list_html_ga147d8efed21d957e6591270026c5ae94"><div class="ttname"><a href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a></div><div class="ttdeci">#define SRMListForeach(item, list)</div><div class="ttdoc">Iterate over items in a linked list from front to back.</div><div class="ttdef"><b>Definition</b> SRMList.h:206</div></div>
<div class="ttc" id="agroup___s_r_m_list_html_gac41e0503a9d64f39aaa7bac0d207a2a6"><div class="ttname"><a href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a></div><div class="ttdeci">void * srmListItemGetData(SRMListItem *item)</div><div class="ttdoc">Get the data associated with an SRMListItem.</div></div>
<div class="ttc" id="agroup___s_r_m_log_html_gae3624e7ed9ccb636356ae78a28969d0b"><div class="ttname"><a href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a></div><div class="ttdeci">void SRMLog(const char *format,...)</div><div class="ttdoc">Print a general message independent of the SRM_DEBUG value.</div></div>
</div><!-- fragment --><p> Here, we are simply iterating over each <code>SRMDevice</code> (GPU/DRM device) and its associated SRMConnectors (screens/displays), printing the DRM id, name, model, and manufacturer of each. Afterward, we conclude the program.</p>
<p>Lets compile the program by running:</p>
<div class="fragment"><div class="line">cd builddir</div>
<div class="line">meson compile</div>
</div><!-- fragment --><p>If there are no errors during the build process, you should find a new executable file in the <code>builddir</code> directory named <code>srm-example</code>. You can run it with the following command:</p>
<div class="fragment"><div class="line">./srm-example</div>
</div><!-- fragment --><p>The output should display one or more devices along with their respective connectors information. For example, on my machine, which has a single GPU, the output appears as follows:</p>
<div class="fragment"><div class="line">[srm-example] Device /dev/dri/card0 connectors:</div>
<div class="line">[srm-example] - Connector 77 eDP-0 Color LCD Apple Computer Inc.</div>
<div class="line">[srm-example] - Connector 84 DisplayPort-1 Unknown Unknown.</div>
<div class="line">[srm-example] - Connector 92 HDMI-A-1 Unknown Unknown.</div>
<div class="line">[srm-example] - Connector 98 DisplayPort-0 Unknown Unknown.</div>
<div class="line">[srm-example] - Connector 104 HDMI-A-2 Unknown Unknown.</div>
<div class="line">[srm-example] - Connector 108 HDMI-A-0 Unknown Unknown.</div>
</div><!-- fragment --><p>Please note that in the output, connectors may appear as "Unknown" for model and manufacturer if no display is attached to those connectors. This is the expected behavior.</p>
<p>In my case, you can observe that there is only one connected, which corresponds to my laptop screen (eDP-0). You can check the connectivity status of any connector with the <a class="el" href="group___s_r_m_connector.html#gad3851c7cb22f2f63886786c2b28de6e1" title="Check if the connector is connected.">srmConnectorIsConnected()</a> function, which we will demonstrate in the upcoming sections.</p>
<h3><a class="anchor" id="autotoc_md19"></a>
Rendering</h3>
<p>Now, let's delve into the process of rendering to the available connectors. Our approach involves setting up a unified interface for managing OpenGL rendering events, which will be shared across all connectors. While it's possible to employ distinct interfaces for each connector, for the sake of simplicity, we'll use a single one here.</p>
<p>It's of utmost importance to underscore that these events are initiated by SRM itself and should not be manually triggered by you. Additionally, it's essential to recognize that all these events are executed within the rendering thread of each connector, operating independently from the main thread.</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> initializeGL(<a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(userData);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* You must not do any drawing here as it won&#39;t make it to</span></div>
<div class="line"><span class="comment">     * the screen. */</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="group___s_r_m_connector_mode.html#ga63f3409299045d0edc2c40e824f99a9a">SRMConnectorMode</a> *mode = <a class="code hl_function" href="group___s_r_m_connector.html#gae510cfc30e622abd259dffb335d29d25">srmConnectorGetCurrentMode</a>(connector);</div>
<div class="line"> </div>
<div class="line">    glViewport(0, </div>
<div class="line">               0, </div>
<div class="line">               <a class="code hl_function" href="group___s_r_m_connector_mode.html#gac19e77acc4d242f6e7ab29b00b520cc4">srmConnectorModeGetWidth</a>(mode), </div>
<div class="line">               <a class="code hl_function" href="group___s_r_m_connector_mode.html#ga7d658ef34656965ddac8cefa1fbfec41">srmConnectorModeGetHeight</a>(mode));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Schedule a repaint (this eventually calls paintGL() later, not directly)</span></div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_connector.html#ga1eb0d3f9a00d2b03823ecf9b9b2e663e">srmConnectorRepaint</a>(connector);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> paintGL(<a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(userData);</div>
<div class="line"> </div>
<div class="line">    glClearColor((sinf(color) + 1.f) / 2.f,</div>
<div class="line">                 (sinf(color * 0.5f) + 1.f) / 2.f,</div>
<div class="line">                 (sinf(color * 0.25f) + 1.f) / 2.f,</div>
<div class="line">                 1.f);</div>
<div class="line"> </div>
<div class="line">    color += 0.01f;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (color &gt; M_PI*4.f)</div>
<div class="line">        color = 0.f;</div>
<div class="line"> </div>
<div class="line">    glClear(GL_COLOR_BUFFER_BIT);</div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_connector.html#ga1eb0d3f9a00d2b03823ecf9b9b2e663e">srmConnectorRepaint</a>(connector);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> resizeGL(<a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* You must not do any drawing here as it won&#39;t make it to</span></div>
<div class="line"><span class="comment">     * the screen.</span></div>
<div class="line"><span class="comment">     * This is called when the connector changes its current mode,</span></div>
<div class="line"><span class="comment">     * set with srmConnectorSetMode() */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Reuse initializeGL() as it only sets the viewport</span></div>
<div class="line">    initializeGL(connector, userData);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> pageFlipped(<a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(connector);</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(userData);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* You must not do any drawing here as it won&#39;t make it to</span></div>
<div class="line"><span class="comment">     * the screen.</span></div>
<div class="line"><span class="comment">     * This is called when the last rendered frame is now being</span></div>
<div class="line"><span class="comment">     * displayed on screen.</span></div>
<div class="line"><span class="comment">     * Google v-sync for more info. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> uninitializeGL(<a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector, <span class="keywordtype">void</span> *userData)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(connector);</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(userData);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* You must not do any drawing here as it won&#39;t make it to</span></div>
<div class="line"><span class="comment">     * the screen.</span></div>
<div class="line"><span class="comment">     * Here you should free any resource created on initializeGL()</span></div>
<div class="line"><span class="comment">     * like shaders, programs, textures, etc. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_struct" href="struct_s_r_m_connector_interface.html">SRMConnectorInterface</a> connectorInterface =</div>
<div class="line">{</div>
<div class="line">    .<a class="code hl_variable" href="struct_s_r_m_connector_interface.html#a9ae832ddf259fabf55bb328a8e207048">initializeGL</a> = &amp;initializeGL,</div>
<div class="line">    .paintGL = &amp;paintGL,</div>
<div class="line">    .resizeGL = &amp;resizeGL,</div>
<div class="line">    .pageFlipped = &amp;pageFlipped,</div>
<div class="line">    .uninitializeGL = &amp;uninitializeGL</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga1eb0d3f9a00d2b03823ecf9b9b2e663e"><div class="ttname"><a href="group___s_r_m_connector.html#ga1eb0d3f9a00d2b03823ecf9b9b2e663e">srmConnectorRepaint</a></div><div class="ttdeci">UInt8 srmConnectorRepaint(SRMConnector *connector)</div><div class="ttdoc">Schedules a new rendering frame.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_gae510cfc30e622abd259dffb335d29d25"><div class="ttname"><a href="group___s_r_m_connector.html#gae510cfc30e622abd259dffb335d29d25">srmConnectorGetCurrentMode</a></div><div class="ttdeci">SRMConnectorMode * srmConnectorGetCurrentMode(SRMConnector *connector)</div><div class="ttdoc">Get the current connector mode.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_mode_html_ga63f3409299045d0edc2c40e824f99a9a"><div class="ttname"><a href="group___s_r_m_connector_mode.html#ga63f3409299045d0edc2c40e824f99a9a">SRMConnectorMode</a></div><div class="ttdeci">struct SRMConnectorModeStruct SRMConnectorMode</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:132</div></div>
<div class="ttc" id="agroup___s_r_m_connector_mode_html_ga7d658ef34656965ddac8cefa1fbfec41"><div class="ttname"><a href="group___s_r_m_connector_mode.html#ga7d658ef34656965ddac8cefa1fbfec41">srmConnectorModeGetHeight</a></div><div class="ttdeci">UInt32 srmConnectorModeGetHeight(SRMConnectorMode *connectorMode)</div><div class="ttdoc">Get the height of the connector mode.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_mode_html_gac19e77acc4d242f6e7ab29b00b520cc4"><div class="ttname"><a href="group___s_r_m_connector_mode.html#gac19e77acc4d242f6e7ab29b00b520cc4">srmConnectorModeGetWidth</a></div><div class="ttdeci">UInt32 srmConnectorModeGetWidth(SRMConnectorMode *connectorMode)</div><div class="ttdoc">Get the width of the connector mode.</div></div>
<div class="ttc" id="astruct_s_r_m_connector_interface_html"><div class="ttname"><a href="struct_s_r_m_connector_interface.html">SRMConnectorInterface</a></div><div class="ttdoc">Interface for OpenGL events handling.</div><div class="ttdef"><b>Definition</b> SRMConnector.h:42</div></div>
<div class="ttc" id="astruct_s_r_m_connector_interface_html_a9ae832ddf259fabf55bb328a8e207048"><div class="ttname"><a href="struct_s_r_m_connector_interface.html#a9ae832ddf259fabf55bb328a8e207048">SRMConnectorInterface::initializeGL</a></div><div class="ttdeci">void(* initializeGL)(SRMConnector *connector, void *data)</div><div class="ttdoc">Notifies that the connector has been initialized.</div><div class="ttdef"><b>Definition</b> SRMConnector.h:51</div></div>
</div><!-- fragment --><p>Lets see what each event does:</p>
<ul>
<li><b>initializeGL:</b> This event is called once after a connector is initialized with <a class="el" href="group___s_r_m_connector.html#ga20dc529d6d584c860517c8c918a4f0f9" title="Initializes a connector, creating its rendering thread and invoking initializeGL() once initialized.">srmConnectorInitialize()</a>. Here you should set up all your necessary OpenGL resources, such as shaders, texture loading, etc. In this specific case, it configures the viewport using the dimensions of the current connector mode (<code>SRMConnectorMode</code>). A connector can have multiple modes, each defining resolution and refresh rate. Additionally, it calls <a class="el" href="group___s_r_m_connector.html#ga1eb0d3f9a00d2b03823ecf9b9b2e663e" title="Schedules a new rendering frame.">srmConnectorRepaint()</a>, which schedules a new rendering frame (<code>paintGL()</code> call) asynchronously.</li>
<li><b>resizeGL:</b> This event is triggered when the current connector mode changes (set with <a class="el" href="group___s_r_m_connector.html#ga223cd6c290d3032bd82df4d4f47cadee" title="Sets the current mode of the connector.">srmConnectorSetMode()</a>). Here, the main task is to update the viewport to match the new dimensions.</li>
<li><b>paintGL:</b> Inside this event handler, you should perform all the OpenGL rendering operations required for the current frame. In the provided example, the screen is simply cleared with a random color and a new frame is scheduled with <a class="el" href="group___s_r_m_connector.html#ga1eb0d3f9a00d2b03823ecf9b9b2e663e" title="Schedules a new rendering frame.">srmConnectorRepaint()</a>.</li>
<li><b>pageFlipped:</b> This event is triggered when the last rendered frame (in <code>paintGL()</code>) is now being displayed on the screen (check <a href="https://en.wikipedia.org/wiki/Multiple_buffering">Multiple Buffering</a>).</li>
<li><b>uninitializeGL:</b> This event is triggered just before the connector is uninitialized. Here you should free the resources created in <code>initializeGL()</code>.</li>
</ul>
<p>Important Note: It is imperative that you avoid initializing, uninitializing, or changing a connector's mode within its rendering thread, that is, from any of the event handlers. Doing so could lead to a deadlock or even cause your program to crash. Please be aware that this behavior is slated for correction in the upcoming SRM release.</p>
<p>Now lets use this interface to initialize all connected connectors.</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group___s_r_m_core.html#ga535bab8ce74776687f1b66a321b35015">SRMCore</a> *core = <a class="code hl_function" href="group___s_r_m_core.html#gabc5505d6e241d3f651b141603739f91e">srmCoreCreate</a>(&amp;srmInterface, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!core)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#ga8a60293d45a096708565a6adabac25fe">SRMFatal</a>(<span class="stringliteral">&quot;[srm-example] Failed to create SRMCore.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Loop each GPU (device)</span></div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a> (deviceIt, <a class="code hl_function" href="group___s_r_m_core.html#gafb45ad48fb818c38a7a3064c67fed689">srmCoreGetDevices</a>(core))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_typedef" href="group___s_r_m_device.html#ga485029078e487fd57bbda129ca369db5">SRMDevice</a> *device = <a class="code hl_function" href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a>(deviceIt);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a>(<span class="stringliteral">&quot;[srm-example] Device %s connectors:&quot;</span>, <a class="code hl_function" href="group___s_r_m_device.html#ga4b8f4e240df729a8244220706bd046ae">srmDeviceGetName</a>(device));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Loop each GPU connector (screen)</span></div>
<div class="line">        <a class="code hl_define" href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a> (connectorIt, <a class="code hl_function" href="group___s_r_m_device.html#ga077ac04ca0f71c03c3ef0364b466c525">srmDeviceGetConnectors</a>(device))</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector = <a class="code hl_function" href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a>(connectorIt);</div>
<div class="line">            <a class="code hl_function" href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a>(<span class="stringliteral">&quot;[srm-example] - Connector %d %s %s %s.&quot;</span>,</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga2749a649be32fdff7627af6e4b00fbf8">srmConnectorGetID</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga5cabbb1dbf56c76797eb6dea2ebed898">srmConnectorGetModel</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga0be5072f8fddeb1a5b0431a17b3491c2">srmConnectorGetManufacturer</a>(connector));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Check if there is a display attached</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_function" href="group___s_r_m_connector.html#gad3851c7cb22f2f63886786c2b28de6e1">srmConnectorIsConnected</a>(connector))</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Initialize the connector</span></div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code hl_function" href="group___s_r_m_connector.html#ga20dc529d6d584c860517c8c918a4f0f9">srmConnectorInitialize</a>(connector, &amp;connectorInterface, NULL))</div>
<div class="line">                {</div>
<div class="line">                    <a class="code hl_function" href="group___s_r_m_log.html#gae0517e0e3e1f98eb753b40bf35a5a7a6">SRMError</a>(<span class="stringliteral">&quot;[srm-example] Failed to initialize connector %s&quot;</span>,</div>
<div class="line">                             <a class="code hl_function" href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a>(connector));</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Sleep 10 secs</span></div>
<div class="line">    usleep(10000000);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_core.html#ga491d9d7ebe4c63ddd2768a11487d3134">srmCoreDestroy</a>(core);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga20dc529d6d584c860517c8c918a4f0f9"><div class="ttname"><a href="group___s_r_m_connector.html#ga20dc529d6d584c860517c8c918a4f0f9">srmConnectorInitialize</a></div><div class="ttdeci">UInt8 srmConnectorInitialize(SRMConnector *connector, SRMConnectorInterface *interface, void *userData)</div><div class="ttdoc">Initializes a connector, creating its rendering thread and invoking initializeGL() once initialized.</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_gad3851c7cb22f2f63886786c2b28de6e1"><div class="ttname"><a href="group___s_r_m_connector.html#gad3851c7cb22f2f63886786c2b28de6e1">srmConnectorIsConnected</a></div><div class="ttdeci">UInt8 srmConnectorIsConnected(SRMConnector *connector)</div><div class="ttdoc">Check if the connector is connected.</div></div>
<div class="ttc" id="agroup___s_r_m_log_html_gae0517e0e3e1f98eb753b40bf35a5a7a6"><div class="ttname"><a href="group___s_r_m_log.html#gae0517e0e3e1f98eb753b40bf35a5a7a6">SRMError</a></div><div class="ttdeci">void SRMError(const char *format,...)</div><div class="ttdoc">Report a nonfatal error. SRM_DEBUG &gt;= 2.</div></div>
</div><!-- fragment --><p>Now, we're checking each connector's display attachment status using <a class="el" href="group___s_r_m_connector.html#gad3851c7cb22f2f63886786c2b28de6e1" title="Check if the connector is connected.">srmConnectorIsConnected()</a> and initializing them with <a class="el" href="group___s_r_m_connector.html#ga20dc529d6d584c860517c8c918a4f0f9" title="Initializes a connector, creating its rendering thread and invoking initializeGL() once initialized.">srmConnectorInitialize()</a>.</p>
<p>Additionally, note that we've included a <code>usleep()</code> call at the end to wait for 10 seconds. This delay is necessary because, as said before, each connector performs its rendering in its own thread. Blocking the main thread ensures that the program doesn't exit immediately.</p>
<p>Re-compile with <code>meson compile</code> and before running the program, switch to a free virtual terminal (TTY) by pressing <code>CTRL + ALT + F[1, 2, 3 ..., 10]</code> or with the <code>chvt N</code> command and launch it from there. You should observe your displays changing colors rapidly for 10 seconds.</p>
<p>If you encounter issues, please attempt to run the program with superuser privileges or by adding your user to the video group. This may resolve any potential permission-related problems.</p>
<p>Additionally, you have the option to set the <b>SRM_DEBUG</b> environment variable to 3 in order to enable fatal, error and warning logging messages.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Hotplugging Events</h2>
<p>Thus far, we've discussed the process of identifying available connectors and initializing them at program startup. However, a critical consideration is what happens if one of these connectors becomes disconnected while the program is running, such as unplugging an HDMI display.</p>
<p>In such scenarios, the connectors are programmed to undergo automatic uninitialization when they become disconnected, triggering their corresponding <code>uninitializeGL()</code> event. However, you do have the flexibility to include listeners to detect and respond to connectors plugging and unplugging events, as exemplified below:</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> connectorPluggedEventHandler(<a class="code hl_typedef" href="group___s_r_m_listener.html#ga355399afe827f447e245e6348e2b346e">SRMListener</a> *listener, <a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(listener);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* This is called when a new connector is avaliable (E.g. Plugging an HDMI display). */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Got a new connector, let&#39;s render on it */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code hl_function" href="group___s_r_m_connector.html#ga20dc529d6d584c860517c8c918a4f0f9">srmConnectorInitialize</a>(connector, &amp;connectorInterface, NULL))</div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#gae0517e0e3e1f98eb753b40bf35a5a7a6">SRMError</a>(<span class="stringliteral">&quot;[srm-example] Failed to initialize connector %s&quot;</span>,</div>
<div class="line">                             <a class="code hl_function" href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a>(connector));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> connectorUnpluggedEventHandler(<a class="code hl_typedef" href="group___s_r_m_listener.html#ga355399afe827f447e245e6348e2b346e">SRMListener</a> *listener, <a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(listener);</div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_types.html#ga1fa8cad2c59d1d2c01d30d75c68ecf81">SRM_UNUSED</a>(connector);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* This is called when a connector is no longer avaliable (E.g. Unplugging an HDMI display). */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* The connnector is automatically uninitialized after this event (if initialized)</span></div>
<div class="line"><span class="comment">     * so calling srmConnectorUninitialize() is not necessary. */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group___s_r_m_core.html#ga535bab8ce74776687f1b66a321b35015">SRMCore</a> *core = <a class="code hl_function" href="group___s_r_m_core.html#gabc5505d6e241d3f651b141603739f91e">srmCoreCreate</a>(&amp;srmInterface, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!core)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#ga8a60293d45a096708565a6adabac25fe">SRMFatal</a>(<span class="stringliteral">&quot;[srm-example] Failed to create SRMCore.&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Subscribe to udev events</span></div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_core.html#ga0e4a797f978af8bbdec3a3c1b84f5f4a">srmCoreAddConnectorPluggedEventListener</a>(core, &amp;connectorPluggedEventHandler, NULL);</div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_core.html#gaefdd250f642c51b8384c9270c7257b7b">srmCoreAddConnectorUnpluggedEventListener</a>(core, &amp;connectorUnpluggedEventHandler, NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Loop each GPU (device)</span></div>
<div class="line">    <a class="code hl_define" href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a> (deviceIt, <a class="code hl_function" href="group___s_r_m_core.html#gafb45ad48fb818c38a7a3064c67fed689">srmCoreGetDevices</a>(core))</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_typedef" href="group___s_r_m_device.html#ga485029078e487fd57bbda129ca369db5">SRMDevice</a> *device = <a class="code hl_function" href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a>(deviceIt);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a>(<span class="stringliteral">&quot;[srm-example] Device %s connectors:&quot;</span>, <a class="code hl_function" href="group___s_r_m_device.html#ga4b8f4e240df729a8244220706bd046ae">srmDeviceGetName</a>(device));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Loop each GPU connector (screen)</span></div>
<div class="line">        <a class="code hl_define" href="group___s_r_m_list.html#ga147d8efed21d957e6591270026c5ae94">SRMListForeach</a> (connectorIt, <a class="code hl_function" href="group___s_r_m_device.html#ga077ac04ca0f71c03c3ef0364b466c525">srmDeviceGetConnectors</a>(device))</div>
<div class="line">        {</div>
<div class="line">            <a class="code hl_typedef" href="group___s_r_m_connector.html#gae730ec771a6d54b3bdee04d719bd799f">SRMConnector</a> *connector = <a class="code hl_function" href="group___s_r_m_list.html#gac41e0503a9d64f39aaa7bac0d207a2a6">srmListItemGetData</a>(connectorIt);</div>
<div class="line">            <a class="code hl_function" href="group___s_r_m_log.html#gae3624e7ed9ccb636356ae78a28969d0b">SRMLog</a>(<span class="stringliteral">&quot;[srm-example] - Connector %d %s %s %s.&quot;</span>,</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga2749a649be32fdff7627af6e4b00fbf8">srmConnectorGetID</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga5cabbb1dbf56c76797eb6dea2ebed898">srmConnectorGetModel</a>(connector),</div>
<div class="line">                   <a class="code hl_function" href="group___s_r_m_connector.html#ga0be5072f8fddeb1a5b0431a17b3491c2">srmConnectorGetManufacturer</a>(connector));</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_function" href="group___s_r_m_connector.html#gad3851c7cb22f2f63886786c2b28de6e1">srmConnectorIsConnected</a>(connector))</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">if</span> (!<a class="code hl_function" href="group___s_r_m_connector.html#ga20dc529d6d584c860517c8c918a4f0f9">srmConnectorInitialize</a>(connector, &amp;connectorInterface, NULL))</div>
<div class="line">                {</div>
<div class="line">                    <a class="code hl_function" href="group___s_r_m_log.html#gae0517e0e3e1f98eb753b40bf35a5a7a6">SRMError</a>(<span class="stringliteral">&quot;[srm-example] Failed to initialize connector %s&quot;</span>,</div>
<div class="line">                             <a class="code hl_function" href="group___s_r_m_connector.html#ga2294dccfe3dd0eaf3fc25ce33e50f397">srmConnectorGetName</a>(connector));</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (1)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">/* Udev monitor poll DRM devices/connectors hotplugging events (-1 disables timeout).</span></div>
<div class="line"><span class="comment">         * To get a pollable FD use srmCoreGetMonitorFD() */</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="group___s_r_m_core.html#gaf917f75c7c5fb7acca27034a02f91840">srmCoreProcessMonitor</a>(core, -1) &lt; 0)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_core.html#ga491d9d7ebe4c63ddd2768a11487d3134">srmCoreDestroy</a>(core);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup___s_r_m_core_html_ga0e4a797f978af8bbdec3a3c1b84f5f4a"><div class="ttname"><a href="group___s_r_m_core.html#ga0e4a797f978af8bbdec3a3c1b84f5f4a">srmCoreAddConnectorPluggedEventListener</a></div><div class="ttdeci">SRMListener * srmCoreAddConnectorPluggedEventListener(SRMCore *core, void(*callback)(SRMListener *, SRMConnector *), void *userData)</div><div class="ttdoc">Registers a new listener to be invoked when a new connector is plugged.</div></div>
<div class="ttc" id="agroup___s_r_m_core_html_gaefdd250f642c51b8384c9270c7257b7b"><div class="ttname"><a href="group___s_r_m_core.html#gaefdd250f642c51b8384c9270c7257b7b">srmCoreAddConnectorUnpluggedEventListener</a></div><div class="ttdeci">SRMListener * srmCoreAddConnectorUnpluggedEventListener(SRMCore *core, void(*callback)(SRMListener *, SRMConnector *), void *userData)</div><div class="ttdoc">Registers a new listener to be invoked when an already plugged connector is unplugged.</div></div>
<div class="ttc" id="agroup___s_r_m_core_html_gaf917f75c7c5fb7acca27034a02f91840"><div class="ttname"><a href="group___s_r_m_core.html#gaf917f75c7c5fb7acca27034a02f91840">srmCoreProcessMonitor</a></div><div class="ttdeci">Int32 srmCoreProcessMonitor(SRMCore *core, Int32 msTimeout)</div><div class="ttdoc">Dispatch pending udev monitor events or block until an event occurs or a timeout is reached.</div></div>
<div class="ttc" id="agroup___s_r_m_listener_html_ga355399afe827f447e245e6348e2b346e"><div class="ttname"><a href="group___s_r_m_listener.html#ga355399afe827f447e245e6348e2b346e">SRMListener</a></div><div class="ttdeci">struct SRMListenerStruct SRMListener</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:144</div></div>
</div><!-- fragment --><p>Now, each time a new connector becomes available, <code>connectorPluggedEventHandler()</code> will be invoked, allowing us to initialize the new connector. Similarly, we can detect when a connector is disconnected using <code>connectorUnpluggedEventHandler()</code>. If an initialized connector gets disconnected, it is automatically uninitialized, triggering the <code>uninitializeGL()</code> function.</p>
<p>One notable change is the replacement of the <code>usleep()</code> function with an infinite <code>while</code> loop. Within this loop, we poll a <code>udev</code> monitor file descriptor using the <code><a class="el" href="group___s_r_m_core.html#gaf917f75c7c5fb7acca27034a02f91840" title="Dispatch pending udev monitor events or block until an event occurs or a timeout is reached.">srmCoreProcessMonitor()</a></code> function. This change is necessary to allow SRM to check and invoke the hotplugging events.</p>
<p>To test these changes, recompile the program and try connecting and disconnecting an external display on the fly. You should observe that it is automatically initialized and uninitialized each time, reflecting the hotplugging events.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Buffers</h2>
<p>SRM lets you create buffers (OpenGL textures) from various sources, including DMA planes, GBM buffer objects, Wayland DRM buffers, and main memory buffers. These buffers can be used for rendering on all connectors, even if they belong to different devices.</p>
<p>Let's see how to create a buffer from main memory:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;SRM/SRMBuffer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// 128 x 256 ARGB8 image in main memory</span></div>
<div class="line"><a class="code hl_typedef" href="group___s_r_m_types.html#ga181146552e9c087e6c61efe0527c5073">UInt8</a> pixelsSource[128 * 256 * 4];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Pass NULL as the allocator device to share the buffer across all devices</span></div>
<div class="line"><a class="code hl_typedef" href="group___s_r_m_buffer.html#ga2ff3252b4281b1e7b47d6bbe2b8642dd">SRMBuffer</a> *buffer = <a class="code hl_function" href="group___s_r_m_buffer.html#gac907e3c8544a5af950100d210d5e082b">srmBufferCreateFromCPU</a>(</div>
<div class="line">    core, <span class="comment">// SRM core</span></div>
<div class="line">    NULL, <span class="comment">// allocator device</span></div>
<div class="line">    128, <span class="comment">// src width</span></div>
<div class="line">    256, <span class="comment">// src height</span></div>
<div class="line">    128 * 4, <span class="comment">// src stride</span></div>
<div class="line">    pixelsSource, </div>
<div class="line">    DRM_FORMAT_ARGB8888);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (!buffer)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_log.html#gae0517e0e3e1f98eb753b40bf35a5a7a6">SRMError</a>(<span class="stringliteral">&quot;Failed to create a buffer from main memory.&quot;</span>);</div>
<div class="line">    exit(1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Use the buffer in a connector rendering thread (paintGL() event)</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Retrieve the OpenGL texture ID</span></div>
<div class="line">GLuint textureId = <a class="code hl_function" href="group___s_r_m_buffer.html#gaf836790dd44ead49b0885fa0fcaff581">srmBufferGetTextureID</a>(</div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_connector.html#ga4b26177d6657294a6616d8c87e07032e">srmConnectorGetRendererDevice</a>(connector), </div>
<div class="line">    buffer);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (textureId == 0)</div>
<div class="line">    <a class="code hl_function" href="group___s_r_m_log.html#gae0517e0e3e1f98eb753b40bf35a5a7a6">SRMError</a>(<span class="stringliteral">&quot;Failed to get the GL texture ID from SRMBuffer.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">GLenum textureTarget = <a class="code hl_function" href="group___s_r_m_buffer.html#ga3e1598f38ffab6fb9dba78f211475273">srmBufferGetTextureTarget</a>(buffer);</div>
<div class="line">glBindTexture(textureTarget, textureId);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ... glDrawArrays() </span></div>
<div class="ttc" id="agroup___s_r_m_buffer_html_ga2ff3252b4281b1e7b47d6bbe2b8642dd"><div class="ttname"><a href="group___s_r_m_buffer.html#ga2ff3252b4281b1e7b47d6bbe2b8642dd">SRMBuffer</a></div><div class="ttdeci">struct SRMBufferStruct SRMBuffer</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:148</div></div>
<div class="ttc" id="agroup___s_r_m_buffer_html_ga3e1598f38ffab6fb9dba78f211475273"><div class="ttname"><a href="group___s_r_m_buffer.html#ga3e1598f38ffab6fb9dba78f211475273">srmBufferGetTextureTarget</a></div><div class="ttdeci">GLenum srmBufferGetTextureTarget(SRMBuffer *buffer)</div><div class="ttdoc">Gets the OpenGL texture target associated with an SRMBuffer.</div></div>
<div class="ttc" id="agroup___s_r_m_buffer_html_gac907e3c8544a5af950100d210d5e082b"><div class="ttname"><a href="group___s_r_m_buffer.html#gac907e3c8544a5af950100d210d5e082b">srmBufferCreateFromCPU</a></div><div class="ttdeci">SRMBuffer * srmBufferCreateFromCPU(SRMCore *core, SRMDevice *allocator, UInt32 width, UInt32 height, UInt32 stride, const void *pixels, SRM_BUFFER_FORMAT format)</div><div class="ttdoc">Creates an SRMBuffer from main memory buffer.</div></div>
<div class="ttc" id="agroup___s_r_m_buffer_html_gaf836790dd44ead49b0885fa0fcaff581"><div class="ttname"><a href="group___s_r_m_buffer.html#gaf836790dd44ead49b0885fa0fcaff581">srmBufferGetTextureID</a></div><div class="ttdeci">GLuint srmBufferGetTextureID(SRMDevice *device, SRMBuffer *buffer)</div><div class="ttdoc">Retrieves an OpenGL texture ID associated with an SRMBuffer for a specific device (GPU).</div></div>
<div class="ttc" id="agroup___s_r_m_connector_html_ga4b26177d6657294a6616d8c87e07032e"><div class="ttname"><a href="group___s_r_m_connector.html#ga4b26177d6657294a6616d8c87e07032e">srmConnectorGetRendererDevice</a></div><div class="ttdeci">SRMDevice * srmConnectorGetRendererDevice(SRMConnector *connector)</div><div class="ttdoc">Retrieve the renderer device associated with the connector.</div></div>
<div class="ttc" id="agroup___s_r_m_types_html_ga181146552e9c087e6c61efe0527c5073"><div class="ttname"><a href="group___s_r_m_types.html#ga181146552e9c087e6c61efe0527c5073">UInt8</a></div><div class="ttdeci">uint8_t UInt8</div><div class="ttdoc">Alias for an unsigned 8-bit integer (uint8_t).</div><div class="ttdef"><b>Definition</b> SRMTypes.hh:56</div></div>
</div><!-- fragment --><p>It's essential to acknowledge that all buffers are shared across all devices, with the exception of those created from GBM buffers or Wayland DRM buffers, which may not always be supported by all devices.</p>
<p>Furthermore, you have the option to read from and write to these buffers, and they are automatically synchronized across all devices. For more in-depth information, please refer to the <a href="https://cuarzosoftware.github.io/SRM/group___s_r_m_buffer.html">SRMBuffer</a> documentation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<script>
    var menu = false;
    var burger, nav;
    function resp()
    {
        if (window.innerWidth < 768)
        {
            burger.hidden = false;
            nav.hidden = true;
        }
        else
        {
            burger.hidden = true;
            nav.hidden = false;
        }
        menu = false;
    }
    function toggleMenu()
    {
        nav.hidden = menu;
        menu = !menu;
    }
    window.onload = function()
    {
        nav = document.getElementById('main-nav');
        burger = document.createElement('div');
        burger.style.position = 'absolute';
        burger.style.top = '14px';
        burger.style.right = burger.style.top;
        burger.innerHTML = '<svg onclick="toggleMenu()" height="32px" viewBox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>';
        document.getElementById('top').appendChild(burger);
        resp();
    };
    window.onresize = function()
    {
        resp();
    };
</script>
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">Project developed by <a href="https://github.com/CuarzoSoftware"><img class="footer" src="https://avatars.githubusercontent.com/u/29326763?s=200&v=4" style="margin-left:2px;position:relative;top:-1px;width:12px;height:12px" alt="cuarzo"/> Cuarzo Software</a></li>
    </ul>
</div>